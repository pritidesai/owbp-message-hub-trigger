# Wskdeploy manifest for openwhisk-cloudant-trigger
# GitHub repo is located at https://github.com/IBM/openwhisk-message-hub-trigger

# Deployment using this manifest file creates the following OpenWhisk components:
#   Package:  openwhisk-messagehub
#   Package:  messagehub-trigger
#   Action:   messagehub-trigger/process-message.js
#   Sequence: messagehub-trigger/process-message-messagehub-sequence
#   Trigger:  message-received-trigger
#   Rule:     log-message-rule

# This manifest file reads the following env. variables:
#   KAFKA_BROKERS
#   MESSAGEHUB_USER
#   MESSAGEHUB_PASS
#   KAFKA_TOPIC

package:
  name: messagehub-trigger
  namespace: _
  triggers:
    message-received-trigger:
      source: /whisk.system/messaging/messageHubFeed
      inputs:
        kafka_brokers_sasl: $KAFKA_BROKERS
        user: $MESSAGEHUB_USER
        password: $MESSAGEHUB_PASS
        isJSONData: true
        topic: $KAFKA_TOPIC
  actions:
      process-message:
        location: actions/process-message.js
  rules:
      log-message-rule:
        trigger: message-received-trigger
        action: messagehub-trigger/process-message
